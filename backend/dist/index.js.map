{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":";;;;;AAAA,gDAAuB;AACvB,sDAA6B;AAC7B,mCAA6D;AAC7D,mCAA+B;AAC/B,6CAA0D;AAC1D,qCAAkD;AAClD,qCAAqC;AACrC,iDAA6C;AAE7C,KAAK,CAAC,KAAK,IAAI,EAAE;IACf,IAAI,GAAG,GAAsB,IAAI,CAAA;IACjC,IAAI,CAAC;QACH,GAAG,GAAG,IAAA,sBAAgB,GAAE,CAAA;QACxB,MAAM,IAAA,mBAAQ,EAAC,GAAG,CAAC,CAAA;QACnB,MAAM,UAAU,GAAG,IAAA,iBAAO,GAAE,CAAA;QAC5B,UAAU,CAAC,GAAG,CAAC,IAAA,cAAI,GAAE,CAAC,CAAA;QACtB,UAAU,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE;YACnC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;QAClB,CAAC,CAAC,CAAA;QACF,IAAA,oCAAyB,EAAC,UAAU,EAAE,GAAG,CAAC,CAAA;QAC1C,MAAM,IAAA,4BAAqB,EAAC,UAAU,EAAE,GAAG,EAAE,mBAAU,CAAC,CAAA;QACxD,UAAU,CAAC,MAAM,CAAC,SAAG,CAAC,IAAI,EAAE,GAAG,EAAE;YAC/B,OAAO,CAAC,IAAI,CAAC,iCAAiC,SAAG,CAAC,IAAI,EAAE,CAAC,CAAA;QAC3D,CAAC,CAAC,CAAA;IACJ,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAA;QACpB,MAAM,GAAG,EAAE,IAAI,EAAE,CAAA;IACnB,CAAC;AACH,CAAC,CAAC,EAAE,CAAA","sourcesContent":["import cors from 'cors'\nimport express from 'express'\nimport { createAppContext, type AppContext } from './lib/ctx'\nimport { env } from './lib/env'\nimport { applyPassportToExpressApp } from './lib/passport'\nimport { applyTrpcToExpressApp } from './lib/trpc'\nimport { trpcRouter } from './router'\nimport { presetDb } from './scripts/presetDB'\n\nvoid (async () => {\n  let ctx: AppContext | null = null\n  try {\n    ctx = createAppContext()\n    await presetDb(ctx)\n    const expressApp = express()\n    expressApp.use(cors())\n    expressApp.get('/ping', (req, res) => {\n      res.send('pong')\n    })\n    applyPassportToExpressApp(expressApp, ctx)\n    await applyTrpcToExpressApp(expressApp, ctx, trpcRouter)\n    expressApp.listen(env.PORT, () => {\n      console.info(`Listening at http://localhost:${env.PORT}`)\n    })\n  } catch (error) {\n    console.error(error)\n    await ctx?.stop()\n  }\n})()\n"]}